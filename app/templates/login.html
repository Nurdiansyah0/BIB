{% extends "base.html" %}
{% block title %}Login - Bandara Internasional Hang Nadim{% endblock %}

{% block head_extra %}
<style>
  .login-container {
    background: linear-gradient(135deg,
      rgba(0,114,188,0.92),
      rgba(242,101,34,0.92),
      rgba(139,197,63,0.92)
    );
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.25);
    padding: 30px;
    width: 350px;
    text-align: center;
    color: #fff;
    border: 1px solid rgba(255,255,255,0.18);
  }
  .logo { margin-bottom: 25px; }
  .logo img { max-width: 200px; height: auto; }
  h2 { color:#fff; margin-bottom:20px; }
  .input-group { margin-bottom:20px; text-align:left; }
  label { display:block; margin-bottom:5px; color:#fff; font-weight:bold; }
  input, select {
    width:100%; padding:10px; border:1px solid #ddd; border-radius:5px; box-sizing:border-box;
  }
  button {
    background-color:#F26522; color:#fff;
    border:none; padding:12px 20px; border-radius:5px; cursor:pointer;
    width:100%; font-size:16px; font-weight:bold; transition:background-color .3s;
  }
  button:hover { background-color:#8BC53F; }
  .footer { margin-top:20px; font-size:12px; color:#eee; }
  .pwd-wrap { position:relative; }
  .pwd-wrap input { padding-right:42px; }
  .pwd-eye {
    position:absolute; right:8px; top:50%; transform:translateY(-50%);
    background:transparent; border:0; cursor:pointer; padding:4px;
    width:auto; line-height:0; color:#444;
  }
  .pwd-eye svg { display:block; }
  .forgot-link { display:inline-block; margin-top:6px; font-size:12px; color:#fff; text-decoration:underline; }
  #register-modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,.5); align-items:center; justify-content:center; z-index:9999; }
  #register-modal .box { background:#fff; color:#333; padding:20px; border-radius:8px; width:320px; box-shadow:0 8px 24px rgba(0,0,0,.2); }
  #register-modal .box h3 { margin-top:0; }
  #register-modal .box .input-group label { color:#333; }
  #register-modal .box input, #register-modal .box select { width:100%; padding:10px; border:1px solid #ddd; border-radius:5px; box-sizing:border-box; }
  #do-register { background:#F26522; color:#fff; margin-top:10px; }
  #close-register { margin-top:8px; width:100%; }
  #reg-msg { font-size:12px; color:#0072BC; }
  .pwd-eye .icon-open { display:none; }
  .pwd-eye[aria-pressed="true"] .icon-closed { display:none; }
  .pwd-eye[aria-pressed="true"] .icon-open { display:inline; }
  .pwd-eye .icon-open .eyelid { transform-origin: 50% 50%; transform: scaleY(1); transition: transform .22s ease; }
  .pwd-eye[aria-pressed="true"] .icon-open .eyelid { transform: scaleY(0); }
  .pwd-eye svg { transition: opacity .18s ease; }
</style>
{% endblock %}

{% block content %}
  <div class="login-container">
    <div class="logo">
      <img src="/static/logo-hangnadim.webp" alt="Bandara Internasional Hang Nadim">
    </div>

    <h2>Login ke Sistem</h2>

    <form id="login-form" action="/login" method="POST" autocomplete="on">
      <div class="input-group">
        <label for="username">NIP</label>
        <input type="text" id="username" name="username" placeholder="Masukkan NIP Anda" required autocomplete="username" />
      </div>

      <div class="input-group">
        <label for="password">Password</label>
        <div class="pwd-wrap">
          <input type="password" id="password" name="password" placeholder="Masukkan password Anda" required autocomplete="current-password" />
          <button type="button" class="pwd-eye" aria-label="Tampilkan/sembunyikan password"
                  data-target="password" title="Tampilkan" aria-pressed="false">
            <!-- Eye CLOSED -->
            <svg class="icon-closed" width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12Z"
                    stroke="currentColor" stroke-width="2"/>
              <circle cx="12" cy="12" r="3" fill="currentColor"/>
              <path d="M4 4 L20 20" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
            </svg>
            <!-- Eye OPEN -->
            <svg class="icon-open" width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12Z"
                    stroke="currentColor" stroke-width="2"/>
              <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
              <rect class="eyelid" x="2" y="3" width="20" height="18" rx="9" fill="currentColor" opacity="0.0"/>
            </svg>
          </button>
        </div>
        <a id="forgot-link" href="#" class="forgot-link">Lupa sandi?</a>
      </div>

      <button type="submit">MASUK</button>
      <button type="button" id="open-register" style="margin-top:10px;background:#0072BC;color:#fff">DAFTAR</button>
    </form>

    <div class="footer">
      Â© 2023 Bandara Internasional Hang Nadim. All rights reserved.
    </div>
  </div>

  <!-- modal registrasi -->
  <div id="register-modal">
    <div class="box">
      <h3>Buat Akun Baru</h3>

      <div class="input-group">
        <label for="reg-username">Username/NIP</label>
        <input type="text" id="reg-username" required autocomplete="username"/>
      </div>

      <div class="input-group">
        <label for="reg-email">Email</label>
        <input type="email" id="reg-email" required autocomplete="email" placeholder="user@example.com"/>
      </div>

      <div class="input-group">
        <label for="reg-password">Password</label>
        <div class="pwd-wrap">
          <input type="password" id="reg-password" required autocomplete="new-password"/>
          <button type="button" class="pwd-eye" aria-label="Tampilkan/sembunyikan password"
                  data-target="reg-password" title="Tampilkan" aria-pressed="false">
            <!-- Eye CLOSED -->
            <svg class="icon-closed" width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12Z"
                    stroke="currentColor" stroke-width="2"/>
              <circle cx="12" cy="12" r="3" fill="currentColor"/>
              <path d="M4 4 L20 20" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
            </svg>
            <!-- Eye OPEN -->
            <svg class="icon-open" width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12Z"
                    stroke="currentColor" stroke-width="2"/>
              <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
              <rect class="eyelid" x="2" y="3" width="20" height="18" rx="9" fill="currentColor" opacity="0.0"/>
            </svg>
          </button>
        </div>
      </div>

      

      <button id="do-register">DAFTAR SEKARANG</button>
      <button id="close-register">BATAL</button>
      <p id="reg-msg"></p>
    </div>
  </div>

{% endblock %}

{% block scripts %}
<script>
    const API_BASE = '/api';

    // Modal Register
    const modal = document.getElementById('register-modal');
    const openBtn = document.getElementById('open-register');
    const closeBtn = document.getElementById('close-register');
    const doRegisterBtn = document.getElementById('do-register');

    openBtn.onclick = () => { modal.style.display = 'flex'; };
    closeBtn.onclick = () => { modal.style.display = 'none'; };
    modal.addEventListener('click', (e) => { if (e.target === modal) modal.style.display = 'none'; });

    // Eye Toggle
    function bindEyeToggles() {
      document.querySelectorAll('.pwd-eye').forEach(btn => {
        btn.setAttribute('aria-pressed', 'false');
        btn.title = 'Tampilkan';

        btn.addEventListener('click', () => {
          const targetId = btn.getAttribute('data-target');
          const input = document.getElementById(targetId);
          const isOpen = btn.getAttribute('aria-pressed') === 'true';

          btn.setAttribute('aria-pressed', String(!isOpen));
          btn.title = isOpen ? 'Tampilkan' : 'Sembunyikan';
          input.type = isOpen ? 'password' : 'text';

          input.focus({ preventScroll: true });
          try {
            const len = input.value.length;
            input.setSelectionRange(len, len);
          } catch (e) {}
        });
      });
    }
    bindEyeToggles();

    // Register Action
    doRegisterBtn.onclick = async () => {
      const username = document.getElementById('reg-username').value.trim();
      const email    = document.getElementById('reg-email').value.trim();
      const password = document.getElementById('reg-password').value;
      const msg      = document.getElementById('reg-msg');

      function setMsg(t, ok=false){ msg.textContent=t; msg.style.color = ok ? '#8BC53F' : '#F26522'; }
      const emailOk = /.+@.+\..+/.test(email);
      if (!username || !password || !emailOk) {
        setMsg('Lengkapi data: username, email valid, password.');
        return;
      }
      try {
        doRegisterBtn.disabled = true;
        const res = await fetch(`${API_BASE}/register`, {
          method: 'POST',
          headers: { 'Content-Type':'application/json' },
          body: JSON.stringify({ username, email, password })
        });
        const data = await res.json().catch(()=>({}));
        if (res.ok) {
          setMsg('Registrasi berhasil. Silakan login.', true);
          setTimeout(() => { modal.style.display = 'none'; }, 1200);
        } else {
          setMsg(data.detail || 'Registrasi gagal');
        }
      } catch (e) {
        setMsg('Terjadi kesalahan jaringan.');
      } finally {
        doRegisterBtn.disabled = false;
      }
    };

    // // Dummy login
    // document.getElementById('login-form').addEventListener('submit', async (e) => {
    //   e.preventDefault();
    //   const nip = document.getElementById('username').value.trim();
    //   const pass = document.getElementById('password').value;

    //   if (nip && pass) {
    //     alert('Login dummy sukses (ganti dengan request ke backend).');
    //   }
    // });
  </script>
{% endblock %}
